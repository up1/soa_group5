/*! grafana - v4.2.0 - 2017-03-22
 * Copyright (c) 2017 Torkel Ã–degaard; Licensed Apache-2.0 */

System.register(["jquery.flot","jquery.flot.selection","jquery.flot.time","jquery.flot.stack","jquery.flot.stackpercent","jquery.flot.fillbelow","jquery.flot.crosshair","./jquery.flot.events","jquery","lodash","moment","app/core/utils/kbn","app/core/core","./graph_tooltip","./threshold_manager"],function(a,b){"use strict";var c,d,e,f,g,h,i;b&&b.id;return{setters:[function(a){},function(a){},function(a){},function(a){},function(a){},function(a){},function(a){},function(a){},function(a){c=a},function(a){d=a},function(a){e=a},function(a){f=a},function(a){g=a},function(a){h=a},function(a){i=a}],execute:function(){g.coreModule.directive("grafanaGraph",["$rootScope","timeSrv",function(a,b){return{restrict:"A",template:"",link:function(a,j){function k(a){if(!H.legend.show||H.legend.rightSide)return 0;if(H.legend.alignAsTable){var b=d.default.filter(B,function(a){return a.hideFromLegend(H.legend)===!1}),c=23+21*b.length;return Math.min(c,Math.floor(a/2))}return 26}function l(){try{var a=F.height-k(F.height);return j.css("height",a+"px"),!0}catch(a){return console.log(a),!1}}function m(){return!B||(!l()||(0===K||void 0))}function n(b){for(var e=b.getYAxes(),g=0;g<B.length;g++){var h=B[g],i=e[h.yaxis-1],k=f.default.valueFormats[H.yaxes[h.yaxis-1].format];if(d.default.isNumber(H.decimals))h.updateLegendValues(k,H.decimals,null);else{var l=(i.tickDecimals||-1)+1;h.updateLegendValues(k,l,i.scaledDecimals+2)}J.$$phase||a.$digest()}if(H.yaxes[0].label){c.default("<div class='axisLabel left-yaxis-label flot-temp-elem'></div>").text(H.yaxes[0].label).appendTo(j)}if(H.yaxes[1].label){c.default("<div class='axisLabel right-yaxis-label flot-temp-elem'></div>").text(H.yaxes[1].label).appendTo(j)}L.draw(b)}function o(a,b){var c=H.yaxes[0],d=H.yaxes[1];c.show&&c.label&&(b.left=20),d.show&&d.label&&(b.right=20);for(var e=a.getYAxes(),f=0;f<e.length;f++){var g=e[f],h=H.yaxes[f];g.options.max=h.max,g.options.min=h.min}}function p(a){for(var b=Number.MAX_VALUE,c=0;c<a.length;c++)if(a[c].stats.timeStep){if(H.bars){if(a[c].bars&&a[c].bars.show===!1)continue}else if("undefined"==typeof a[c].bars||"undefined"==typeof a[c].bars.show||!a[c].bars.show)continue;a[c].stats.timeStep<b&&(b=a[c].stats.timeStep)}return b}function q(){function a(a){try{D=c.default.plot(j,E,e),F.renderError&&(delete F.error,delete F.inspector)}catch(a){console.log("flotcharts error",a),F.error=a.message||"Render Error",F.renderError=!0,F.inspector={error:a}}a&&F.renderingCompleted()}if(K=j.width(),!m()){L.prepare(j,B);for(var b=!!H.stack||null,e={hooks:{draw:[n],processOffset:[o]},legend:{show:!1},series:{stackpercent:!!H.stack&&H.percentage,stack:H.percentage?null:b,lines:{show:H.lines,zero:!1,fill:r(H.fill),lineWidth:H.linewidth,steps:H.steppedLine},bars:{show:H.bars,fill:1,barWidth:1,zero:!1,lineWidth:0},points:{show:H.points,fill:1,fillColor:!1,radius:H.points?H.pointradius:2},shadowSize:0},yaxes:[],xaxis:{},grid:{minBorderMargin:0,markings:[],backgroundColor:null,borderWidth:0,hoverable:!0,clickable:!0,color:"#c8c8c8",margin:{left:0,right:0}},selection:{mode:"x",color:"#666"},crosshair:{mode:"x"}},f=0;f<B.length;f++){var g=B[f];g.data=g.getFlotPairs(g.nullPointMode||H.nullPointMode),F.hiddenSeries[g.alias]&&(g.data=[],g.stack=!1)}switch(H.xaxis.mode){case"series":e.series.bars.barWidth=.7,e.series.bars.align="center";for(var f=0;f<B.length;f++){var g=B[f];g.data=[[f+1,g.stats[H.xaxis.values[0]]]]}u(e);break;case"table":e.series.bars.barWidth=.7,e.series.bars.align="center",v(e);break;default:e.series.bars.barWidth=p(B)/1.5,t(e)}L.addPlotOptions(e,H),w(e),x(B,e),E=d.default.sortBy(B,function(a){return a.zindex}),s(H)?(a(!1),setTimeout(function(){a(!0)},50),I=H.legend.rightSide):a(!0)}}function r(a){return 0===a?.001:a/10}function s(a){return!!a.legend.rightSide||(null!==I&&a.legend.rightSide!==I||void 0)}function t(a){var b=K/100,c=d.default.isUndefined(F.range.from)?null:F.range.from.valueOf(),e=d.default.isUndefined(F.range.to)?null:F.range.to.valueOf();a.xaxis={timezone:G.getTimezone(),show:H.xaxis.show,mode:"time",min:c,max:e,label:"Datetime",ticks:b,timeformat:A(b,c,e)}}function u(a){var b=d.default.map(B,function(a,b){return[b+1,a.alias]});a.xaxis={timezone:G.getTimezone(),show:H.xaxis.show,mode:null,min:0,max:b.length+1,label:"Datetime",ticks:b}}function v(a){var b=d.default.map(B,function(a,b){return d.default.map(a.datapoints,function(c,d){var e=b*a.datapoints.length+d;return[e+1,c[1]]})});b=d.default.flatten(b,!0),a.xaxis={timezone:G.getTimezone(),show:H.xaxis.show,mode:null,min:0,max:b.length+1,label:"Datetime",ticks:b}}function w(a){if(C&&0!==C.length){var b={};b.$__alerting={color:"rgba(237, 46, 24, 1)",position:"BOTTOM",markerSize:5},b.$__ok={color:"rgba(11, 237, 50, 1)",position:"BOTTOM",markerSize:5},b.$__no_data={color:"rgba(150, 150, 150, 1)",position:"BOTTOM",markerSize:5},b.$__execution_error=["$__no_data"];for(var c=0;c<C.length;c++){var e=C[c];e.newState?(console.log(e.newState),e.eventType="$__"+e.newState):b[e.source.name]||(b[e.source.name]={color:e.source.iconColor,position:"BOTTOM",markerSize:5})}a.events={levels:d.default.keys(b).length+1,data:C,types:b}}}function x(a,b){var c={position:"left",show:H.yaxes[0].show,index:1,logBase:H.yaxes[0].logBase||1,max:null};if(b.yaxes.push(c),d.default.find(a,{yaxis:2})){var e=d.default.clone(c);e.index=2,e.show=H.yaxes[1].show,e.logBase=H.yaxes[1].logBase||1,e.position="right",b.yaxes.push(e),y(b.yaxes[1],a),z(b.yaxes[1],H.percentage&&H.stack?"percent":H.yaxes[1].format)}y(b.yaxes[0],a),z(b.yaxes[0],H.percentage&&H.stack?"percent":H.yaxes[0].format)}function y(a,b){if(1!==a.logBase){var c,d,e=a.max;if(null===e){for(d=0;d<b.length;d++)c=b[d],c.yaxis===a.index&&e<c.stats.max&&(e=c.stats.max);void 0===e&&(e=Number.MAX_VALUE)}a.min=null!==a.min?a.min:0,a.ticks=[0,1];for(var f=1;;)if(f*=a.logBase,a.ticks.push(f),f>e)break;10===a.logBase?(a.transform=function(a){return Math.log(a+.1)},a.inverseTransform=function(a){return Math.pow(10,a)}):(a.transform=function(b){return Math.log(b+.1)/Math.log(a.logBase)},a.inverseTransform=function(b){return Math.pow(a.logBase,b)})}}function z(a,b){a.tickFormatter=function(a,c){return f.default.valueFormats[b](a,c.tickDecimals,c.scaledDecimals)}}function A(a,b,c){if(b&&c&&a){var d=c-b,e=d/a/1e3,f=864e5,g=31536e6;return e<=45?"%H:%M:%S":e<=7200||d<=f?"%H:%M":e<=8e4?"%m/%d %H:%M":e<=2419200||d<=g?"%m/%d":"%Y-%m"}return"%H:%M"}var B,C,D,E,F=a.ctrl,G=F.dashboard,H=F.panel,I=null,J=a.$root,K=0,L=new i.ThresholdManager(F),M=new h.default(j,G,a,function(){return E});F.events.on("panel-teardown",function(){L=null,D&&(D.destroy(),D=null)}),F.events.on("render",function(a){B=a||B,B&&(C=F.annotations,q())}),g.appEvents.on("graph-hover",function(a){G.sharedTooltipModeEnabled()&&D&&a.panel.id!==H.id&&!F.otherPanelInFullscreenMode()&&M.show(a.pos)},a),g.appEvents.on("graph-hover-clear",function(a,b){D&&M.clear(D)},a),j.bind("plotselected",function(c,d){a.$apply(function(){b.setTime({from:e.default.utc(d.xaxis.from),to:e.default.utc(d.xaxis.to)})})}),a.$on("$destroy",function(){M.destroy(),j.off(),j.remove()})}}}])}}});